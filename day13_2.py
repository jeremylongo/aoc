class Cart(object):
    def __init__(self, id, x, y, direction):
        self.id = id
        self.x = x
        self.y = y
        # direction can be 0 (up), 1 (right), 2 (down), 3 (left)
        self.direction = direction
        # next change : -1 (turn left), 0 (straight), 1 (turn right)
        self.next_change = -1

    def get_key(self):
        return self.y * 10000 + self.x

    def move(self, tracks):
        if self.direction == 0:
            self.y -= 1
            if tracks[self.y][self.x] == '\\':
                # print("%s turned left" % self.id)
                self.direction = 3
            elif tracks[self.y][self.x] == '/':
                # print("%s turned right" % self.id)
                self.direction = 1
        elif self.direction == 1:
            self.x += 1
            if tracks[self.y][self.x] == '\\':
                # print("%s turned right" % self.id)
                self.direction = 2
            elif tracks[self.y][self.x] == '/':
                # print("%s turned left" % self.id)
                self.direction = 0
        elif self.direction == 2:
            self.y += 1
            if tracks[self.y][self.x] == '\\':
                # print("%s turned left" % self.id)
                self.direction = 1
            elif tracks[self.y][self.x] == '/':
                # print("%s turned right" % self.id)
                self.direction = 3
        elif self.direction == 3:
            self.x -= 1
            if tracks[self.y][self.x] == '\\':
                # print("%s turned right" % self.id)
                self.direction = 0
            elif tracks[self.y][self.x] == '/':
                # print("%s turned left" % self.id)
                self.direction = 2
        if tracks[self.y][self.x] == '+':
            self.direction += self.next_change
            # if self.next_change == -1:
            #     print("crossroad : %s turned left" % self.id)
            # elif self.next_change == 1:
            #     print("crossroad : %s turned right" % self.id)
            # else:
            #     print("crossroad : %s continued forward" % self.id)
            self.next_change += 1
            if self.direction > 3:
                self.direction = 0
            if self.direction == -1:
                self.direction = 3
            if self.next_change > 1:
                self.next_change = -1


def build_map(data=""):
    result = data.replace('>', '-').replace('<', '-').replace('^', '|').replace('v', '|')
    result = result.splitlines(False)
    return result


def build_carts_map(data = ""):
    res = {}
    data = data.splitlines(False)
    id = 0
    for y in range(0, len(data)):
        row = data[y]
        for x in range(0, len(row)):
            direction = None
            if row[x] == '^':
                direction = 0
            elif row[x] == '>':
                direction = 1
            elif row[x] == 'v':
                direction = 2
            elif row[x] == '<':
                direction = 3
            if direction is not None:
                cart = Cart(id, x, y, direction)
                id += 1
                res[cart.get_key()] = cart
    return res


def move_carts(tracks, carts):
    new_carts = {}
    collision = None
    for k in sorted(carts.keys()):
        if k in carts:
            cart = carts[k]
            cart.move(tracks)
            new_key = cart.get_key()
            if new_key in carts:
                # crash. Remove both carts.
                del(carts[new_key])
            elif new_key in new_carts:
                # crash. Remove both carts.
                del(new_carts[new_key])
                print('crash at %s, %s' % (cart.x, cart.y))
            else:
                new_carts[new_key] = cart
    carts.clear()
    carts.update(new_carts)


def print_tracks(tracks, carts):
    for y in range(0, len(tracks)):
        s = "%s\t" % y
        row = tracks[y]
        for x in range(0, len(row)):
            if y * 10000 + x in carts:
                s += '*'
            else:
                s += row[x]

        print(s)


data = """/>-<\\  
|   |  
| /<+-\\
| | | v
\\>+</ |
  |   ^
  \\<->/
"""

data = """                            /-----------------\\                   /--------------------------------------------------------------------------------\\
                       /----+----------\\      |  /----------------+-------------------------------------------------------------------\\            |
                       |    |    /-----+---\\  |  | /--------------+->-----------------------------------------------------------\\     |            |
                      /+----+----+-----+---+--+--+-+--------------+-----------------------\\       /----<-------------------\\    |     |            |
   /------------------++----+----+-----+---+--+--+-+------------\\ |      /----------------+-------+------------------------+----+-----+--\\         |
   |                  ||    |    |     |   |  |  | |            | |/-----+----------------+-------+--------------\\         |    |     |  |         |
   |                  ||    |    |     |   |  |  | |            | ||     v      /---------+-------+--------------+---------+----+-----+--+--\\      |
   |                  ||    |    |     |  /+--+--+-+--------\\   | ||     |      |         | /-----+-------\\  /---+---------+----+-----+-\\|  |      |
   |               /--++----+----+-----+--++--+--+-+--------+---+-++-----+------+---------+-+---\\ |       |  |   |         |    |     | ||  |      |
   |      /--------+--++----+----+-----+--++--+--+-+--------+---+-++-----+-----\\|        /+-+---+-+-------+--+---+---------+----+-----+-++--+------+\\
   |      | /------+--++----+----+-----+--++--+--+-+--------+---+-++----<+-----++--------++-+---+-+-\\     |  |   |         |    |     | ||  |      ||
   |      | |      |  ||    |    |     |  ||  | /+-+--------+---+-++-----+-----++--------++-+---+-+-+-----+--+---+---------+----+-----+-++--+----\\ ||
   |   /--+-+------+--++----+----+-----+--++-\\| || |        |   | ||     |     ||        || |   | | |     |  |   |         |    |     | ||  |    | ||
   |   |  | |      |  ||    |    |     |  || || || |        |   | ||     |   /-++--------++-+---+-+-+-----+--+---+-\\       |/---+-----+\\||  |    | ||
   |   |  | |     /+--++----+----+-----+--++-++-++-+-------\\|   | ||/----+---+-++--------++-+---+-+-+-----+--+---+-+-------++---+-----++++--+\\   | ||
   |/--+--+-+-----++--++----+----+-----+--++-++-++-+-------++---+-+++----+---+\\||        || |   | | |     |  |   | |       ||   |     ||||  ||   | ||
   ||  |  | |     ||  ||    |    \\-----+--+/ || || |       ||   | |||    |   ||||        || |   | | |     |  |   | |       ||   |     ||||  ||   | ||
   ||  |  | |/----++--++----+----------+--+--++-++-+-------++---+-+++----+---++++--------++-+->-+-+-+-----+--+---+-+-----\\ ||   |     ||||  ||   | ||
   ||  |  | ||    ||  ||    |          |  |  || |\\-+-------++---+-+++----+---++++--------++-+---+-+-+-----+--+---+-+-----+-++---+-----/|||  ||   | ||
  /++--+--+-++--\\ ||  ||    |          |  |  || |  |       ||   | |||    |   ||||        || |   | | |     |  |   | |     | ||   |      |||  ||   | ||
  |||  |  | ||  | ||  ||    |          |  \\--++-+--+-------+/   | |||    |   ||||        || |   | | |     |  |   | |     | ||   |      |||  ||   | ||
  |||  |  | ||  | ||  ||    |          |     || |  |       |    | |||    |   |||| /------++-+---+-+-+-----+--+---+-+-----+-++---+-----\\|||  ||   | ||
  |||  |  | ||  | ||  ||    |          |     || |  |       |    | |||    |   |||| |/-----++-+---+-+-+-----+--+---+-+-----+-++---+-\\   ||||  ||   | ||
  |||  |  | ||  | ||  || /--+----------+-----++-+--+-------+----+-+++----+---++++\\||     || |   | | |     |  |   | |     | ||   | |   ||||  ||   | ||
  |||  |  | ||  | ||  || |  |          |     || |  |       |    | |||    |   |||\\+++-----++-+---+-+-+-----+--+---+-+-----+-++---+-+---++++--/|   | ||
  |||  |  | ||  | ||  || |  |          |     || | /+---->--+---\\| |||    |   ||| |||    /++-+---+-+-+-----+--+---+-+-----+-++---+-+\\  ||||   |   | ||
  |||  |  |/++--+-++--++-+--+----------+-----++-+-++-------+---++-+++----+---+++-+++----+++-+---+-+-+-----+--+---+-+---\\ | ||   | ||  ||||   |   | ||
  |||  |  ||||  | ||  || |  |    /-----+-----++-+-++-------+---++-+++----+---+++-+++----+++-+---+-+-+-----+--+-\\ | |   | | ||   | ||  ||||   |   | ||
  |||  |  ||||  | ||  || |  |    |     |     || | ||       |   || |\\+----+---+++-+++----+++-+---+-+-+-----+--+-+-/ |   |/+-++---+-++--++++---+---+-++\\
  |||  |  ||\\+--+-++--++-+--+----+-----+-----++-+-++-------+---++-+-+----+---+++-+++----+++-+---+-+-/     |  | |   |   ||| ||   | ||  ||||   |   | |||
 /+++--+--++-+--+-++--++-+--+----+-----+-----++-+-++-------+---++-+-+----+---+++-+++----+++-+--\\| |       |  | |   |   ||| ||   | ||  ||||   |   | |||
 ||||  |  || |  | ||  || |  |    |     |     || | ||       |   || | |    |   ||| |||    ||| \\--++-+-------/  | |   |   ||| ||   | ||  ||||   |   | |||
 ||||  | /++-+--+-++--++-+--+----+-----+-\\   || | ||   /---+---++-+-+----+---+++-+++----+++----++-+----------+-+---+---+++-++---+\\||  ||||   |   | |||
 |||| /+-+++-+--+-++--++-+--+----+-----+-+---++-+-++---+---+---++-+-+----+---+++-+++----+++----++-+---\\      | |   |   ||| ||   ||||  ||||   |   | |||
 |||| || ||| |  | ||  || |  |  /-+-----+-+---++-+-++---+---+---++-+-+--\\ |   ||| |||    |\\+----++-+---+------+-+---+---+++-++---++++--++++---+---+-+/|
 |||| || ||| |  v ||  |\\-+--+--+-+-----/ |   || | ||   | /-+---++-+-+--+-+---+++-+++-\\  | |    || |   |      | |   |   ||| ||   ||||  ||||   |   | | |
 |||| || ||| |  |/++--+--+--+--+-+-------+---++-+-++---+-+-+---++-+-+--+-+---+++-+++-+--+-+----++-+---+------+-+-\\ |   ||| ||   ||||  ||||   |   | | |
 |||| || ||| |  ||||  |  |  |  | |       |   || | ||   | | |   || | |  | |   ||| |\\+-+--+-+----++-+---+------+-+-+-+---+++-++---++++--/|||   |   | | |
 |||| || |||/+--++++--+--+--+--+-+-------+---++-+-++---+-+-+---++-+-+--+-+---+++-+-+-+--+-+----++-+---+------+-+-+-+-\\ ||| ||   ||||   |||   |   | | |
 |||| || |||||  ||||  | /+--+--+-+-----\\ |   || | ||   | | |   || | |  | |   ||| | | |  \\-+----++-+---+------+-+-+-+-+-+++-++---+++/   |||   |   | | |
 |||| || |||||  ||||  | ||  |  | |     |/+---++-+-++---+-+-+---++-+-+--+-+---+++-+-+-+----+----++-+---+------+\\| | | | ||| ||   |||    |||   |   | | |
 |||| || |||||  ||||  |/++--+--+-+-----+++---++-+-++---+-+-+---++-+-+--+-+---+++-+-+-+---\\|    || |   |      ||| | | | ||| ||   |||    |||   |   | | |
 |||| || |||||  ||||  ||||  |  | |     |||   || | ||/--+-+-+---++-+-+--+-+---+++-+-+-+---++----++-+---+------+++-+-+-+-+++-++---+++----+++---+--\\| | |
 ||||/++-+++++--++++--++++--+--+-+-----+++---++-+-+++--+-+-+---++-+-+--+-+---+++-+-+-+---++\\   || |   |      ||| | | | ||| ||   |||    |||   |  || | |
 ||||||| |||||  |||\\--++++--+--+-+-----+++---++-+-+++--+-+-+---++-+-+--+-+---+++-+-+-+---+++---+/ |   |      ||| | | | ||| ||   |||    |||   |  || | |
 ||||||| |||||  ||| /-++++--+--+-+-----+++---++-+-+++-\\| | |   || | |  | |   |||/+-+-+---+++---+--+---+------+++-+-+-+-+++-++---+++----+++-\\ |  || | |
 ||||||| |||||  ||| | ||||/-+--+-+-----+++---++-+-+++-++-+-+---++-+-+--+-+---+++++-+-+---+++---+--+---+------+++-+-+-+-+++-++-\\ |||    ||| | |  || | |
 \\++++++-+++++--+++-+-+++++-+--+-+-----+++---++-+-+++-++-+-+---++-+-+--+-+---+++++-+-+---+++---/  |   |      ||| | | | ||| || | |||    ||| | |  || ^ |
  |||||| |||||  ||| | ||||| |  | |     |||   || | ||| || | |   || | |/-+-+---+++++-+-+---+++------+---+------+++-+-+-+-+++-++-+-+++----+++-+-+--++\\| |
  |||||| |||||  ||| | ||||| |  | |     |||   || | ||| || | |/--++-+-++-+-+---+++++-+-+---+++------+-\\ |      \\++-+-+-+-+++-++-+-+++----+/| | |  |||| |
  |||||| |||||  ||| | ||||| |  | |     |||   || | ||| || | ||  || | || | |   ||||| | |/--+++------+-+-+-------++-+-+-+-+++-++-+-+++-\\  | | | |  |||| |
  ||\\+++-+++++--+++-+-+++++-+--+-+-----+++---++-+-+++-++-+-++--++-+-++-+-+---+/||| | ||  |||      | | |       || | | | ||| ||/+-+++-+--+-+-+-+--++++\\|
  || ||| |||||  ||| | ||||| |  | |     |||   || | ||| || | ||/-++-+-++-+-+\\  | ||| | ^|  |||      | | | /-----++-+-+-+-+++-++++-+++-+--+-+-+-+-\\||||||
  || |||/+++++--+++-+-+++++-+--+-+-----+++---++-+-+++-++-+-+++-++-+-++-+-++--+-+++-+-++--+++------+-+-+\\|     || | | | ||| |||| ||| |  | | | | |||||||
  || |||||||||  ||| | ||||| |  | |     |||   || | ||| || | ||| || \\-++-+-++--+-+++-+-++--+++------+-+-+++-----++-+-+-+-+++-++++-+++-+--+-+-+-+-++++/||
/-++-+++++++++--+++-+-+++++-+--+-+-----+++---++-+-+++-++-+-+++-++---++-+-++--+-+++-+-++--+++------+\\| |||  /--++-+-+-+-+++\\|||| ||| |  | | | | |||| ||
| || |||||||||  ||| | ||||| |  | |     |||   || | |||/++-+-+++-++---++-+-++--+-+++-+-++--+++------+++-+++--+-\\|| | | | |||||||| ||| |  | | | | |||| ||
| || |||||||||  ||| | ||||| |  | |     |||   ||/+-++++++-+-+++-++---++-+-++--+-+++\\| ||  |||      ||| |||  | ||| | | | |||||||| ||| |  | | | | |||| ||
| ||/+++++++++--+++-+\\||||| \\--+-+-----+++---+/|| \\+++++-+-+++-/|   || | ||  | ||||| ||  |||      ||| |||  | ||| | | | |||||||| ||| |  | | | | |||| ||
| ||||||||||||  ||| ||||||| /--+-+-----+++---+-++--+++++-+\\|||  |   |^ | ||  | ||||| ||  |||      ||| |||  | ||| | | | |||||||| ||| |  | | | | |||| ||
| ||||||||||||  ||| ||||||| |  | |     |||   | ||  ||||| |||||  |/--++-+-++--+<+++++-++--+++------+++-+++--+-+++-+-+-+-++++++++-+++-+\\ | | | | |||| ||
| ||||||||||||  ||| ||||||| |  | |     |||  /+-++--+++++-+++++--++--++-+-++--+-+++++-++--+++------+++-+++-\\| ||| | | | |||||||| ||| || | | | | |||| ||
| ||||||||||||  ||| ||||||| |  | |     |||  || ||/-+++++-+++++--++--++-+-++--+-+++++-++-\\|||      ||| ||| || ||| | | | |||||||| ||| || | | | | |||| ||
| ||||||||||||  |\\+-+++++++-+--+-+-----+++--++-+++-+++++-+++++--++--++-+-++--+-+++++-++-++++------+++-+++-++-+++-/ | | |||||||| ||| || | | | | |||| ||
| |||||||||||\\--+-+-+++++++-+--+-+-----+++--++-+++-+++++-+++++--++--++-+-++--+-+++++-++-++++------+++-+++-++-+++---+-+-++/||||| ||| || | | | | |||| ||
| |||||||||||   | | ||\\++++-+--+-+-----+++--++-+++-+++++-+++++--++--++-+-++--+-+++++-++-++/|      ||| ||| || |||   | | || ||||| ||| || | | | | |||| ||
| |||||||||||   | | || |||| |  | |   /-+++--++-+++-+++++-+++++--++--++-+-++--+-+++++-++-++-+------+++-+++-++-+++---+-+-++-+++++-+++-++-+\\| | | |||| ||
| |||||||||||   | | || |||| |  | |   | |||  || ||| |\\+++-+++++--++--++-+-++--+-+++++-++-++-+------+++-+++-++-+++---+-+-++-+++++-+++-++-+++-+-+-+/|| ||
| |||||||||||  /+-+-++-++++-+--+-+---+-+++--++-+++-+-+++-+++++--++--++-+-++--+-+++++-++-++-+--\\   ||| ||| || |||   |/+-++-+++++-+++-++-+++-+-+-+\\|| ||
| |||||||||||  || | || |||| |  | |   | |||  || ||| | ||| |||||  ||  || | ||  | ||||| || || |  |   ||| ||| || |||   ||| || ||||| ||| || ||| | | |||| ||
| |||||||||||  || | || |||| |  | |   | |||  || ||| | ||| |||||  ||  || | ||  | |\\+++-++-++-+--+---+++-+++-++-+++---+++-++-+++++-+++-++-+++-/ | |||| ||
| |||||||||||  || |/++-++++-+--+-+---+-+++--++-+++-+-+++-+++++--++-\\|| | ||  | | ||| || || |  |   \\++-+++-++-+++---+++-++-+/||| ||| || |||   | |||| ||
| |||||||||||  || |||| |||| |  \\-+---+-+++--++-+++-+-+++-+++++--++-+++-/ ||  | | ||| || ||/+--+----++-+++-++-+++---+++-++-+-+++-+++-++-+++--\\| |||| ||
| |||||||||||  || |||| |||| |    |   | ||| /++-+++-+-+++-+++++--++-+++---++--+-+-+++-++-++++--+----++-+++-++-+++---+++-++-+-+++-+++-++-+++--++\\|||| ||
| |||||||||||  || |||| ||||/+----+---+-+++-+++-+++-+-+++-+++++--++-+++---++--+-+-+++-++-++++--+----++-+++\\|| |||   ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| |\\++++----+---+-/|| ||| ||| | ||| |||||  || |||   ||  | | ||| || ||||  |    || |||||| |||   ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| | ||||    |   |  || ||| ||| | ||| ||||| /++-+++---++--+-+-+++-++\\||||  |    || |||||| |||   ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| | \\+++----+---+--++-+++-+++-+-+++-+++++-+++-+++---++--+-+-/|| |||||||  |    ||/++++++-+++\\  ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| |  |||    |   |  || ||| ||| | ||| ||||| ||| |||   ||  | |  || |||||||  |    ||||||||| ||||  ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| |  |||    |   |  || ||| ||| | ||| ||||| ||| |||   ||  | |  || |||||||/-+----+++++++++-++++--+++-++-+-+++\\||| || |||  ||||||| ||
| |||||||||||  || |||| |  |||    |   |  || ||| ||| | ||| ||||| ||| |||   ||  | |  || |||||||| |    ||||||||| ||||  ||| || | ||||||| || |||  ||||||| ||
| |||||||||||  || |||| |  |||    |   |  || ||| ||| \\-+++-+++++-+++-+++---++--+-+--++-++++++++-+----+++++++++-++++--+++-++-+-++++/|| || |||  ||||||| ||
| |||||||||||  || \\+++-+--+++----+---+--++-+++-+++---+++-++/|| ||| |||   ||/-+-+--++\\|||||||| |    |||||||||/++++--+++-++-+-++++-++-++-+++-\\||||||| ||
| |||||||||||  ||  |||/+--+++----+---+--++-+++-+++---+++-++-++-+++\\|||   ||| | |  ||||||||||| |    ||||||||||||||  ||| || | |||| || || ||| |||||||| ||
| ||||^||||||  ||  |||||  |||    |   |  || ||| |||   ||| || || |||||||   ||| | |  ||||||||||| |    ||||||||||||||  |\\+-++-+-++++-++-++-+++-+++++/|| ||
| |\\+++++++++--++--+++++--+++----+---+--++-+++-+++---+++-++-++-+/|||\\+---+++-+-+--+++++++++++-+----++++++++++++++--+-+-++-+-++++-++-++-+++-++/|| || ||
| | |||||||||  ||  |||||  |||    |   |  || ||| |||   ||| || || | ||| |   ||| | |  ||||||||||| |  /-++++++++++++++-\\| | || | |||| || || ||| || || || ||
| | ||||||\\++--++--+++++--+++----+---+--++-+++-+++---+++-++-++-+-+++-+---+++-+-/  ||||||||||| |  | |||||||||||||| || | || | |||| || || ||| || || || ||
|/+-++++++-++-\\||  |||||  ||\\----+---+--++-+++-+++---+++-+/ || | ||| |   ||| |    ||||||||||| |  | |||||||||||||| || | || | |||| || || ||| || || || ||
||| |||||| || |||  |||||  ||     |   |  || ||| |||   ||| |/-++-+-+++-+\\  ||| |    ||||||||||| |  | |||||||||||||| || | || | |||| || || ||| || || || ||
||| |||||| || |||  |||||  ||     |   |  || ||| |||   ||| || |\\-+-+++-++--+/| |    ||||||||||\\-+--+-++++++++++++++-++-+-++-+-+++/ || || ||| || || || ||
||| |||||| || |||  |||||  ||     |   |  || ||| |||   ||| || |  | ||| ||  | | |    ||||||||||  |  | ||\\++++++++++/ || |/++-+-+++--++-++\\||| || || || ||
||| |||||| || |||  |||||  ||     |   |  || ||| |||   ||| || |  | ||| ||  | | |    ||||||||||  |  | || ||||||||||  || |||| | |||  || |||||| || || || ||
||| |||||| || ||| /+++++--++-----+---+--++-+++-+++---+++-++-+--+-+++-++--+-+-+----++++++++++--+--+-++\\||||||||||  || |||| | |||  || |||||| || || || ||
||| |||||| || ||| ||||||/-++-----+---+--++-+++-+++---+++-++-+--+-+++-++--+-+-+----++++++++++--+--+-+++++++++++++--++-++++-+-+++-\\|| |||||| || || || ||
||| |||||| || ||| ||||||| ||     |   |  || ||| |||   ||| || |  | ||| ||  | | |    ||||||||||  |  | |||||||||||||  || |||| | ||| ||| |||||| || || || ||
||| |||||| || ||| ||||v|| ||     |   |  || ||| |||   ||| || |  | ||| ||  | | |    ||||||||||  |  | |||||||||||||  || |||| | ||| ||| |||||| || || || ||
||| |||||| || |||/+++++++-++----\\|   |  || ||| |||   ||| || |  \\-+++-++--+-+-+----+++++/||||  |  | |||||||||||||  || |||| | ||| ||| |||||| || || || ||
||| |||||| || ||||||||||| ||    ||   |  || ||| |\\+---+++-++-+----+++-++--+-+-+----+++++-++++--+--+-+++++++++++++--++-++++-+-+++-+++-++++++-++-++-/| ||
||| |||||| || ||||||||||| ||    ||   |  || ||| | |   ||| |\\-+----+++-+/  | | |    ||||| ||||  |  | ||||||||||||| /++-++++-+-+++-+++-++++++-++-++--+\\||
||| |||||| || ||||||||||| ||    ||   |  || ||| | |   ||| |  |   /+++-+---+-+-+--\\ ||||| ||||  |  | ||||||||||||| ||| |||| | ||| ||| |||||| || ||  ||||
||| |||||| || ||||||||||| ||    ||   |  || ||| | |   ||\\-+--+---++++-+---+-+-+--+-+++++-++++--+--+-+++++++++++++-+++-++++-+-+++-+/| |||||| || ||  ||||
\\++-++++++-++-+++++++++++-++----++---+--++-+++-+-+---++--+--+---++++-+---+-+-+--+-+++++-++++--+--+-/|||||||||||| ||| |||| | ||| | | |||||| || ||  ||||
 || |||||| || ||||||||||| ||    ||   |  || ||| | |   ||  |  |   |||| |   | | \\--+-+++++-++++--+--+--++++++++++++-++/ |||| | ||| | | |||||| || ||  ||||
 || |||||| || |||||||||\\+-++----++---+--++-+++-+-+---++--+--+---++++-+---+-+----+-+++++-+/||  |  |  |||||||||||| ||  |||| | ||| | | |||||| || ||  ||||
 || |||||| || ||||||||| | ||    ||   |  || ||| | |   \\+--+--+---++++-+---+-+----+-+++++-+-++--+--+--+++++++++/|| ||  |||| | ||| | | |||||| || ||  ||||
 || |||||| || ||||||||| | ||  /-++---+--++-+++-+-+----+--+--+---++++-+---+-+----+-+++++-+-++--+--+--+++++++++-++-++-\\|||| | ||| | | |||||| || ||  ||||
 || |||||| \\+-+++++++++-+-++--+-++---+--++-+++-+-+----+--+--+---++++-+---+-+----+-+++++-+-++--+--+--+++++++++-++-++-+++/| | ||| | | |||||| || ||  ||||
 || ||||||  | ||||\\++++-+-++--+-++---+--++-+++-+-+----+--+--+---++++-+---+-+----+-+++++-+-++--+--+--+/||||||| || || ||| | | ||| | | |||||| || ||  ||||
 || ||||||  | |||| |||| | ||  | ||   |  || ||| | |    |  |  |   |||| |   \\-+----+-+++++-+-++--+--+--+-+++++++-++-++-+++-+-+-+++-+-+-+++++/ || ||  ||||
 || ||||||  | |||| |||| | ||  | ||   |  \\+-+++-+-+----+--+--+---++++-+-----+----+-+++++-+-++--+--+--+-+++++++-/| || ||\\-+-+-+++-+-+-++/||  || ||  ||||
 || ||||||/-+-++++-++++-+-++--+-++---+---+-+++-+-+----+\\ |  |   |||v |     |    | ||||| | ||  |  |  | |||||||  | || ||  | | ||| | | || ||  || ||  ||||
 || |||\\+++-+-++++-++++-+-++--+-++---+---+-++/ | |    || |  |   |||| |     |  /-+-+++++-+-++--+--+--+-+++++++--+-++-++--+-+-+++-+-+-++-++--++-++\\ ||||
 || ||| ||| | |||| |||| | ||  | ||   |   | ||  | |    || | /+---++++-+----\\|  | | |\\+++-+-++--+--+--+-+++++++--+-++-++--+-+-+++-+-/ || ||  || ||| ||||
 || ||| |\\+-+-++++-++++-+-++--+-++---+---/ ||  | |    || | |\\---++++-+----++--+-+-+-+++-+-++--+--+--/ |||||||  | || ||  | | ||| |   || ||  || ||| ||||
 || ||| | | | |||| |||| | || /+-++---+-----++--+-+----++-+-+----++++-+----++--+-+-+-+++-+-++--+--+----+++++++--+-++-++-\\| | ||| |   || ||  || ||| ||||
 || |\\+-+-+-+-++++-++++-+-++-++-++---+-----++--+-+----++-+-+----++++-+----++--+-+-+-+++-+-+/  |  \\----+++++++--+-+/ || || | ||| |   || ||  || ||| ||||
 || | | | | | |||| |||| | || || ||   |     ||  | |    || | |    |||| |    ||  | | | ||| | |   |       ||\\++++--+-+--++-++-+-+++-+---++-++--++-+/| ||||
 || | | | | | |||| |||| | || || ||/--+-----++--+\\|    || | |    |||| |    ||  | | | ||| | |   |      /++-++++--+-+-\\|| || | ||| |   || ||  || | | ||||
 |\\-+-+-+-+-+-++/| |||\\-+-++-++-+++--+-----++--+++----++-+-+----++/| |    ||  | | | ||| | |   |      ||| ||||  | | ||| || | ||| |   || ||  || | | ||||
 |  | \\-+-+-+-++-+-+++--+-++-++-+++--+-----++--+++----++-+-+----++-+-+----++--+-+-+-+++-+-+---+------+/| ||||  | | ||| || | |\\+-+---++-++--++-+-+-++/|
 |  |   | | | || | |||/-+-++-++\\|||  |     ||  \\++----++-+-+----++-+-+----++--+-+-/ ||| | |   |      | | ||||  | | ||| || | \\-+-+---++-/|  || | | || |
 |  |   | | | || | |||| | || |\\++++--+-----++---++----++-+-+----++-+-+----++--+-+---+++-+-+---+------+-+-++++--+-+-+/| || |   | |   ||  |  || | | || |
 |  |   | | | || | |||| | || | ||||  |     ||   ||    || | |    |\\-+-+----++--+-+---+++-+-+---+------+-+-++++--+-+-+-+-++-+---+-+---+/  |  || | | || |
 |  |   | \\-+-++-+-++++-+-++-+-++++--+-----++---++----+/ | |    |  | |    ||  | |   ||| | |   |      | | ||\\+--+-+-+-+-++-/   | |   |   |  || | | || |
 |  |   |   | || | |||| | || | ||||  |     ||   ||    |  | \\----+--+-+----/|  | |   ||| | |  /+------+-+-++-+--+-+-+-+-++-----+\\|   |   |  || | | || |
 |  |/--+---+-++-+-++++-+-++-+-++++--+-\\   ||   ||    |  |      |  | |     |  \\-+---+++-+-+--++------+-+-++-+--+-+-+-+-++-----+++---+---+--++-+-/ || |
 |  ||  |   | || | |||| | || | ||||  | |   \\+---++----+--+------+--+-+-----+----+---+++-+-+--++------+-+-++-+--+-+-+-+-++-----+++---+---+--++-/   || |
 |  ||  |   | || \\-++++-+-++-+-+/\\+--+-+----+---++----+--+------+--+-+-----+----+---+++-+-+--++------+-+-++-+--/ | | | ||     |||   |   |  ||     || |
 |  ||  |   | ||   |||| | || | |  \\--+-+----+---/|    |  |      |  | |     \\----+---/|| | |  ||      | | || |    | | | ||     |||   |   |  ||     || |
 |  ||  |   | ||   |||| \\-++-+-+-----+-+----+----+----+--+------+--+-+----------+----++-+-+--++------+-+-++-+----+-+-+-++-----++/   |   |  ||     || |
 |  ||  |   | ||   ||||   || | |     | |    |    |    |  |      |  | |          |    || | |  ||      | | || |    | | | |\\-----++----+---+--++-----++-/
 \\--++--+---+-/|   |||\\---++-+-/     | |    |    |    |  |      |  | |          |    || | |  || /----+-+-++-+----+-+-+-+------++----+---+--++-\\   ||
    ||  |   |  |   |||    || |       | v    |    |    |  |      |  | |          |    || | |  || |    | | || |    \\-+-+-+------++----+---+--++-+---+/
    ||  |   |  |   |||    || |       | |    |    |    |  |      |  | |          |    || | |  \\+-+----+-+-++-+------+-+-+-->---+/    |   |  || |   |
    ||  |   |  |   |||    \\+-+-------+-+----+----+----+--+------+--+-+----------+----++-+-+---+-+----+-+-++-+------+-+-+------/     |   |  || |   |
    ||  |   |  |   |||     | |       \\-+----+----+----+--+------+--+-+----------+----++-+-+---+-+----+-+-++-+------+-+-+------------+---/  || |   |
    ||  |   |  |   |||     | |         |    \\----+----+--+------+--+-+----------+----++-+-+---+-+----+-+-+/ |      | | |            |      || |   |
    ||  |   \\--+---+++-----+-+---------+---------+----+--+------+--+-+----------+----++-+-+---+-+----+-+-+--+------+-/ |            |      || |   |
    \\+--+------+---++/     | |         |         |    |  |      \\--+-+----------/    || | |   | |    | | |  |      |   |            |      || |   |
     |  |      \\---++------+-+---------+---------+----+--+---------+-+---------------++-+-+---/ |    | | |  \\------+---+------------+------/| |   |
     |  |          ||      | \\---------+---------+----+--+---------+-+---------------++-+-+-----+----+-+-+---------+---/            |       | |   |
     |  |          ||      |           |         |    |  \\---------+-+---------------/| | |     |    | | |         |                |       | |   |
     |  |          |\\------+-----------+---------+----/            | |                \\-+-+-----+----+-+-+---------+----------------/       | |   |
     |  |          |       \\-----------+---------+-----------------+-+------------------+-+-----+----+-+-/         |                        | |   |
     \\--+----------+-------------------/         |                 | |                  | \\-----+----+-+-----------+------------------------/ |   |
        |          |                             |                 | \\------------------+-------+----+-+-----------+--------------------------+---/
        |          \\-----------------------------+-----------------/                    |       |    \\-+-----------/                          |
        \\----------------------------------------+--------------------------------------+-------+------/                                      |
                                                 \\------------------------------------->/       \\---------------------------------------------/
"""

tracks = build_map(data)
carts = build_carts_map(data)

cart = None
while cart is None:
    move_carts(tracks, carts)
    if len(carts) == 1:
        # move_carts(tracks, carts)
        cart = carts.popitem()[1]
# print_tracks(tracks, carts)

print("last cart at %s,%s" % (cart.x, cart.y))
